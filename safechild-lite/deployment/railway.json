{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements.txt",
    "watchPatterns": [
      "backend/**/*.py",
      "requirements.txt"
    ]
  },
  "deploy": {
    "startCommand": "cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  },
  "environments": {
    "development": {
      "variables": {
        "APP_ENV": "development",
        "DEBUG": "true",
        "LOG_LEVEL": "DEBUG",
        "BACKEND_HOST": "0.0.0.0",
        "BACKEND_PORT": "8000"
      }
    },
    "staging": {
      "variables": {
        "APP_ENV": "staging",
        "DEBUG": "false",
        "LOG_LEVEL": "INFO",
        "BACKEND_HOST": "0.0.0.0",
        "BACKEND_PORT": "8000"
      }
    },
    "production": {
      "variables": {
        "APP_ENV": "production",
        "DEBUG": "false",
        "LOG_LEVEL": "WARNING",
        "BACKEND_HOST": "0.0.0.0",
        "BACKEND_PORT": "8000"
      }
    }
  },
  "services": [
    {
      "name": "safechild-backend",
      "type": "web",
      "source": {
        "type": "github",
        "repo": "your-username/safechild-lite",
        "branch": "main",
        "path": "backend"
      },
      "domains": [
        "safechild-lite-backend.railway.app"
      ],
      "variables": {
        "PYTHON_VERSION": "3.9",
        "PIP_CACHE_DIR": "/tmp/pip-cache",
        "PYTHONPATH": "/app"
      },
      "healthcheck": {
        "path": "/health",
        "interval": "30s",
        "timeout": "10s",
        "retries": 3
      }
    }
  ],
  "volumes": [
    {
      "name": "uploads",
      "mountPath": "/app/uploads",
      "size": "1GB"
    },
    {
      "name": "logs",
      "mountPath": "/app/logs",
      "size": "1GB"
    }
  ],
  "networking": {
    "ports": [
      {
        "port": 8000,
        "protocol": "HTTP"
      }
    ]
  },
  "monitoring": {
    "enabled": true,
    "metrics": [
      "cpu",
      "memory",
      "disk",
      "network"
    ],
    "alerts": [
      {
        "name": "High CPU Usage",
        "condition": "cpu > 80%",
        "duration": "5m"
      },
      {
        "name": "High Memory Usage",
        "condition": "memory > 80%",
        "duration": "5m"
      },
      {
        "name": "Service Down",
        "condition": "healthcheck_failed",
        "duration": "1m"
      }
    ]
  },
  "scaling": {
    "minInstances": 1,
    "maxInstances": 5,
    "targetCPUUtilization": 70,
    "targetMemoryUtilization": 80
  },
  "security": {
    "headers": {
      "X-Content-Type-Options": "nosniff",
      "X-Frame-Options": "DENY",
      "X-XSS-Protection": "1; mode=block",
      "Referrer-Policy": "strict-origin-when-cross-origin",
      "Permissions-Policy": "camera=(), microphone=(), geolocation=()"
    },
    "cors": {
      "allowedOrigins": [
        "https://safechild-lite-frontend.vercel.app",
        "http://localhost:8501",
        "http://localhost:3000"
      ],
      "allowedMethods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allowedHeaders": ["*"],
      "allowCredentials": true
    }
  },
  "caching": {
    "enabled": true,
    "strategy": "LRU",
    "maxSize": "100MB",
    "ttl": "3600s"
  },
  "logging": {
    "level": "INFO",
    "format": "json",
    "retention": "30d",
    "export": {
      "enabled": true,
      "destination": "cloudwatch"
    }
  },
  "backup": {
    "enabled": true,
    "schedule": "0 2 * * *",
    "retention": "30d",
    "storage": "s3"
  },
  "maintenance": {
    "enabled": false,
    "window": "02:00-04:00 UTC",
    "message": "System is under scheduled maintenance. Please try again later."
  }
}
